/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={};sigma.tools={};sigma.classes={};sigma.instances={};
(function(){if(!Array.prototype.some)Array.prototype.some=function(D,N){var H=this.length;if(typeof D!="function")throw new TypeError;for(var B=0;B<H;B++)if(B in this&&D.call(N,this[B],B,this))return true;return false};if(!Array.prototype.forEach)Array.prototype.forEach=function(D,N){var H=this.length;if(typeof D!="function")throw new TypeError;for(var B=0;B<H;B++)B in this&&D.call(N,this[B],B,this)};if(!Array.prototype.map)Array.prototype.map=function(D,N){var H=this.length;if(typeof D!="function")throw new TypeError;
for(var B=new Array(H),s=0;s<H;s++)if(s in this)B[s]=D.call(N,this[s],s,this);return B};if(!Array.prototype.filter)Array.prototype.filter=function(D,N){var H=this.length;if(typeof D!="function")throw new TypeError;for(var B=[],s=0;s<H;s++)if(s in this){var M=this[s];D.call(N,M,s,this)&&B.push(M)}return B};if(!Object.keys)Object.keys=function(){var D=Object.prototype.hasOwnProperty,N=!{toString:null}.propertyIsEnumerable("toString"),H=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf",
"propertyIsEnumerable","constructor"],B=H.length;return function(s){if(typeof s!=="object"&&typeof s!=="function"||s===null)throw new TypeError("Object.keys called on non-object");var M=[];for(var w in s)D.call(s,w)&&M.push(w);if(N)for(w=0;w<B;w++)D.call(s,H[w])&&M.push(H[w]);return M}}()})();
sigma.classes.Cascade=function(){this.p={};this.config=function(D,N){if(typeof D=="string"&&N==undefined)return this.p[D];else{var H=typeof D=="object"&&N==undefined?D:{};if(typeof D=="string")H[D]=N;for(var B in H)if(this.p[B]!=undefined)this.p[B]=H[B];return this}}};
sigma.classes.EventDispatcher=function(){function D(w,O){if(!O||!w)return M;(typeof w=="string"?w.split(" "):w).forEach(function(b){s[b]||(s[b]=[]);s[b].push({h:O,one:true})});return M}function N(w,O){if(!O||!w)return M;(typeof w=="string"?w.split(" "):w).forEach(function(b){s[b]||(s[b]=[]);s[b].push({h:O,one:false})});return M}function H(w,O){w||(s={});w=typeof w=="string"?w.split(" "):w;O?w.forEach(function(b){if(s[b])s[b]=s[b].filter(function(n){return n.h!=O});s[b]&&s[b].length==0&&delete s[b]}):
w.forEach(function(b){delete s[b]});return M}function B(w,O){if(s[w]){s[w].forEach(function(b){b.h({type:w,content:O,target:M})});s[w]=s[w].filter(function(b){return!b.one})}return M}var s={},M=this;this.one=D;this.bind=N;this.unbind=H;this.dispatch=B};
(function(){function D(){function b(g,h){if(a.nodesIndex[g])throw new Error('Node "'+g+'" already exists.');h=h||{};var c={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:false,active:false,hidden:false,forceLabel:false,label:g.toString(),id:g.toString(),attr:{}};for(var f in h)switch(f){case "id":break;case "x":case "y":case "size":c[f]=+h[f];break;case "fixed":case "active":case "hidden":case "forceLabel":c[f]=!!h[f];break;case "color":case "label":c[f]=h[f];break;default:c.attr[f]=h[f]}a.nodes.push(c);
a.nodesIndex[g.toString()]=c;return a}function n(g){return{x:g.x,y:g.y,size:g.size,degree:g.degree,inDegree:g.inDegree,outDegree:g.outDegree,displayX:g.displayX,displayY:g.displayY,displaySize:g.displaySize,label:g.label,id:g.id,color:g.color,fixed:g.fixed,active:g.active,hidden:g.hidden,forceLabel:g.forceLabel,attr:g.attr}}function i(g,h){for(var c in h)switch(c){case "id":case "attr":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;case "x":case "y":case "size":g[c]=
+h[c];break;case "fixed":case "active":case "hidden":case "forceLabel":g[c]=!!h[c];break;case "color":case "label":g[c]=(h[c]||"").toString();break;default:g.attr[c]=h[c]}return a}function p(g){((g instanceof Array?g:[g])||[]).forEach(function(h){if(a.nodesIndex[h]){var c=null;a.nodes.some(function(f,k){if(f.id==h){c=k;return true}return false});c!=null&&a.nodes.splice(c,1);delete a.nodesIndex[h];a.edges=a.edges.filter(function(f){if(f.source.id==h){delete a.edgesIndex[f.id];f.target.degree--;f.target.inDegree--;
return false}else if(f.target.id==h){delete a.edgesIndex[f.id];f.source.degree--;f.source.outDegree--;return false}return true})}else sigma.log('Node "'+h+'" does not exist.')});return a}function l(g,h,c,f){if(a.edgesIndex[g])throw new Error('Edge "'+g+'" already exists.');if(!a.nodesIndex[h]){g="Edge's source \""+h+'" does not exist yet.';throw new Error(g);}if(!a.nodesIndex[c]){g="Edge's target \""+c+'" does not exist yet.';throw new Error(g);}f=f||{};h={source:a.nodesIndex[h],target:a.nodesIndex[c],
size:1,weight:1,displaySize:0.5,label:g.toString(),id:g.toString(),hidden:false,attr:{}};h.source.degree++;h.source.outDegree++;h.target.degree++;h.target.inDegree++;for(var k in f)switch(k){case "id":case "source":case "target":break;case "hidden":h[k]=!!f[k];break;case "size":case "weight":h[k]=+f[k];break;case "color":h[k]=f[k].toString();break;case "type":h[k]=f[k].toString();break;case "label":h[k]=f[k];break;default:h.attr[k]=f[k]}a.edges.push(h);a.edgesIndex[g.toString()]=h;return a}function q(g){return{source:g.source.id,
target:g.target.id,size:g.size,type:g.type,weight:g.weight,displaySize:g.displaySize,label:g.label,hidden:g.hidden,id:g.id,attr:g.attr,color:g.color}}function I(g,h){for(var c in h)switch(c){case "id":case "displaySize":break;case "weight":case "size":g[c]=+h[c];break;case "source":case "target":g[c]=a.nodesIndex[c]||g[c];break;case "hidden":g[c]=!!h[c];break;case "color":case "label":case "type":g[c]=(h[c]||"").toString();break;default:g.attr[c]=h[c]}return a}function v(g){((g instanceof Array?g:
[g])||[]).forEach(function(h){if(a.edgesIndex[h]){a.edgesIndex[h].source.degree--;a.edgesIndex[h].source.outDegree--;a.edgesIndex[h].target.degree--;a.edgesIndex[h].target.inDegree--;var c=null;a.edges.some(function(f,k){if(f.id==h){c=k;return true}return false});c!=null&&a.edges.splice(c,1);delete a.edgesIndex[h]}else sigma.log('Edge "'+h+'" does not exist.')});return a}function P(){a.nodes=[];a.nodesIndex={};a.edges=[];a.edgesIndex={};return a}function d(g,h,c,f){var k=0,x=0;c&&a.nodes.forEach(function(o){x=
Math.max(o.size,x)});f&&a.edges.forEach(function(o){k=Math.max(o.size,k)});x=x||1;k=k||1;var t,u,y,L;c&&a.nodes.forEach(function(o){u=Math.max(o.x,u||o.x);t=Math.min(o.x,t||o.x);L=Math.max(o.y,L||o.y);y=Math.min(o.y,y||o.y)});var Q=a.p.scalingMode=="outside"?Math.max(g/Math.max(u-t,1),h/Math.max(L-y,1)):Math.min(g/Math.max(u-t,1),h/Math.max(L-y,1)),R=(a.p.maxNodeSize||x)/Q;u+=R;t-=R;L+=R;y-=R;Q=a.p.scalingMode=="outside"?Math.max(g/Math.max(u-t,1),h/Math.max(L-y,1)):Math.min(g/Math.max(u-t,1),h/Math.max(L-
y,1));var z,C;if(!a.p.maxNodeSize&&!a.p.minNodeSize){z=1;C=0}else if(a.p.maxNodeSize==a.p.minNodeSize){z=0;C=a.p.maxNodeSize}else{z=(a.p.maxNodeSize-a.p.minNodeSize)/x;C=a.p.minNodeSize}var m,J;if(!a.p.maxEdgeSize&&!a.p.minEdgeSize){m=1;J=0}else{m=a.p.maxEdgeSize==a.p.minEdgeSize?0:(a.p.maxEdgeSize-a.p.minEdgeSize)/k;J=a.p.minEdgeSize}c&&a.nodes.forEach(function(o){o.displaySize=o.size*z+C;if(!o.fixed){o.displayX=(o.x-(u+t)/2)*Q+g/2;o.displayY=(o.y-(L+y)/2)*Q+h/2}});f&&a.edges.forEach(function(o){o.displaySize=
o.size*m+J});return a}function r(g,h,c,f,k){var x=Math.pow(c,a.p.nodesPowRatio);f&&a.nodes.forEach(function(t){if(!t.fixed){t.displayX=t.displayX*c+g;t.displayY=t.displayY*c+h}t.displaySize*=x});x=Math.pow(c,a.p.edgesPowRatio);k&&a.edges.forEach(function(t){t.displaySize*=x});return a}function A(){a.borders={};a.nodes.forEach(function(g){a.borders.minX=Math.min(a.borders.minX==undefined?g.displayX-g.displaySize:a.borders.minX,g.displayX-g.displaySize);a.borders.maxX=Math.max(a.borders.maxX==undefined?
g.displayX+g.displaySize:a.borders.maxX,g.displayX+g.displaySize);a.borders.minY=Math.min(a.borders.minY==undefined?g.displayY-g.displaySize:a.borders.minY,g.displayY-g.displaySize);a.borders.maxY=Math.max(a.borders.maxY==undefined?g.displayY-g.displaySize:a.borders.maxY,g.displayY-g.displaySize)})}function F(g,h){var c,f,k,x=[],t=[];a.nodes.forEach(function(u){if(u.hidden)u.hover=false;else{c=Math.abs(u.displayX-g);f=Math.abs(u.displayY-h);k=u.displaySize;var y=u.hover,L=c<k&&f<k&&Math.sqrt(c*c+
f*f)<k;if(y&&!L){u.hover=false;t.push(u.id)}else if(L&&!y){u.hover=true;x.push(u.id)}}});x.length&&a.dispatch("overnodes",x);t.length&&a.dispatch("outnodes",t);return a}function G(g,h){h=h?h.map(function(f){return a.nodesIndex[f]}):a.nodes;var c=h.map(n);c.forEach(g);h.forEach(function(f,k){i(f,c[k])});return a}function E(g,h){h=h?h.map(function(f){return a.edgesIndex[f]}):a.edges;var c=h.map(q);c.forEach(g);h.forEach(function(f,k){I(f,c[k])});return a}function j(g){var h=((g instanceof Array?g:[g])||
[]).map(function(c){return n(a.nodesIndex[c])});return g instanceof Array?h:h[0]}function U(g){var h=((g instanceof Array?g:[g])||[]).map(function(c){return q(a.edgesIndex[c])});return g instanceof Array?h:h[0]}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var a=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:0.5,edgesPowRatio:0};this.borders={};P();this.addNode=b;this.addEdge=l;this.dropNode=p;this.dropEdge=v;this.iterEdges=
E;this.iterNodes=G;this.getEdges=U;this.getNodes=j;this.empty=P;this.rescale=d;this.translate=r;this.setBorders=A;this.checkHover=F}function N(b,n){function i(){if(!q.monitoring)q.monitoring=window.setInterval(l,1E3/q.p.fps);return q}function p(){if(q.monitoring){window.clearInterval(q.monitoring);q.monitoring=null;q.p.dom.innerHTML=""}return q}function l(){var I="";I+="<p>GLOBAL :</p>";for(var v in q.p.globalProbes)I+="<p>"+v+" : "+q.p.globalProbes[v]()+"</p>";I+="<br><p>LOCAL :</p>";for(v in q.p.localProbes)I+=
"<p>"+v+" : "+q.p.localProbes[v]()+"</p>";q.p.dom.innerHTML=I;return q}sigma.classes.Cascade.call(this);var q=this;this.instance=b;this.monitoring=false;this.p={fps:40,dom:n,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return q.instance.graph.nodes.length},"Edges count":function(){return q.instance.graph.edges.length}}};this.activate=i;this.desactivate=
p}function H(b,n){function i(r,A){var F=d.width,G=d.height;if(r!=undefined&&A!=undefined){d.width=r;d.height=A}else{d.width=d.domRoot.offsetWidth;d.height=d.domRoot.offsetHeight}if(F!=d.width||G!=d.height){for(var E in d.domElements){d.domElements[E].setAttribute("width",d.width+"px");d.domElements[E].setAttribute("height",d.height+"px")}d.plotter.resize(d.width,d.height);d.draw(d.p.lastNodes,d.p.lastEdges,d.p.lastLabels,true)}return d}function p(){sigma.chronos.removeTask("node_"+d.id,2).removeTask("edge_"+
d.id,2).removeTask("label_"+d.id,2).stopTasks();return d}function l(r,A){d.domElements[r]=document.createElement(A);d.domElements[r].style.position="absolute";d.domElements[r].setAttribute("id","sigma_"+r+"_"+d.id);d.domElements[r].setAttribute("class","sigma_"+r+"_"+A);d.domElements[r].setAttribute("width",d.width+"px");d.domElements[r].setAttribute("height",d.height+"px");d.domRoot.appendChild(d.domElements[r]);return d}function q(r,A,F,G){if(G&&sigma.chronos.getGeneratorsIDs().some(function(j){return!!j.match(new RegExp("_ext_"+
d.id+"$",""))}))return d;r=r==undefined?d.p.drawNodes:r;A=A==undefined?d.p.drawEdges:A;F=F==undefined?d.p.drawLabels:F;G={nodes:r,edges:A,labels:F};d.p.lastNodes=r;d.p.lastEdges=A;d.p.lastLabels=F;p();d.graph.rescale(d.width,d.height,r>0,A>0).setBorders();d.mousecaptor.checkBorders(d.graph.borders,d.width,d.height);d.graph.translate(d.mousecaptor.stageX,d.mousecaptor.stageY,d.mousecaptor.ratio,r>0,A>0);d.dispatch("graphscaled");for(var E in d.domElements)if(d.domElements[E].nodeName.toLowerCase()==
"canvas"&&(G[E]==undefined||G[E]>=0))d.domElements[E].getContext("2d").clearRect(0,0,d.domElements[E].width,d.domElements[E].height);d.plotter.currentEdgeIndex=0;d.plotter.currentNodeIndex=0;d.plotter.currentLabelIndex=0;E=null;G=false;if(r)if(r>1)for(;d.plotter.task_drawNode(););else{sigma.chronos.addTask(d.plotter.task_drawNode,"node_"+d.id,false);G=true;E="node_"+d.id}if(F)if(F>1)for(;d.plotter.task_drawLabel(););else{E?sigma.chronos.queueTask(d.plotter.task_drawLabel,"label_"+d.id,E):sigma.chronos.addTask(d.plotter.task_drawLabel,
"label_"+d.id,false);G=true;E="label_"+d.id}if(A)if(A>1)for(;d.plotter.task_drawEdge(););else{E?sigma.chronos.queueTask(d.plotter.task_drawEdge,"edge_"+d.id,E):sigma.chronos.addTask(d.plotter.task_drawEdge,"edge_"+d.id,false);G=true;E="edge_"+d.id}d.dispatch("draw");d.refresh();G&&sigma.chronos.runTasks();return d}function I(){d.domElements.hover.getContext("2d").clearRect(0,0,d.domElements.hover.width,d.domElements.hover.height);v();P();return d}function v(){if(d.p.drawHoverNodes){d.graph.checkHover(d.mousecaptor.mouseX,
d.mousecaptor.mouseY);d.graph.nodes.forEach(function(r){r.hover&&!r.active&&d.plotter.drawHoverNode(r)})}return d}function P(){d.p.drawActiveNodes&&d.graph.nodes.forEach(function(r){r.active&&d.plotter.drawActiveNode(r)});return d}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var d=this;this.id=n.toString();this.p={auto:true,drawNodes:2,drawEdges:1,drawLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,drawHoverNodes:true,drawActiveNodes:true};this.domRoot=b;this.width=this.domRoot.offsetWidth;
this.height=this.domRoot.offsetHeight;this.graph=new D;this.domElements={};l("edges","canvas");l("nodes","canvas");l("labels","canvas");l("hover","canvas");l("monitor","div");l("mouse","canvas");this.plotter=new B(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.hover.getContext("2d"),this.graph,this.width,this.height);this.monitor=new N(this,this.domElements.monitor);this.mousecaptor=new s(this.domElements.mouse,
this.id);this.mousecaptor.bind("drag interpolate",function(){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,true)}).bind("stopdrag stopinterpolate",function(){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?1:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,true)}).bind("mousedown mouseup",function(r){var A=d.graph.nodes.filter(function(F){return!!F.hover}).map(function(F){return F.id});d.dispatch(r.type=="mousedown"?"downgraph":"upgraph");if(A.length)d.dispatch(r.type=="mousedown"?
"downnodes":"upnodes",A)}).bind("move",function(){d.domElements.hover.getContext("2d").clearRect(0,0,d.domElements.hover.width,d.domElements.hover.height);v();P()});sigma.chronos.bind("startgenerators",function(){if(sigma.chronos.getGeneratorsIDs().some(function(r){return!!r.match(new RegExp("_ext_"+d.id+"$",""))}))d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels)}).bind("stopgenerators",function(){d.draw()});for(b=0;b<O.plugins.length;b++)O.plugins[b](this);this.draw=
q;this.resize=i;this.refresh=I;this.drawHover=v;this.drawActive=P;this.clearSchedule=p;window.addEventListener("resize",function(){d.resize()})}function B(b,n,i,p,l,q,I){function v(){for(var c=l.edges.length,f,k,x=0;x++<a.p.edgesSpeed&&a.currentEdgeIndex<c;){e=l.edges[a.currentEdgeIndex];f=e.source;k=e.target;if(e.hidden||f.hidden||k.hidden||!a.isOnScreen(f)&&!a.isOnScreen(k))a.currentEdgeIndex++;else A(l.edges[a.currentEdgeIndex++])}return a.currentEdgeIndex<c}function P(){for(var c=l.nodes.length,
f=0;f++<a.p.nodesSpeed&&a.currentNodeIndex<c;)if(a.isOnScreen(l.nodes[a.currentNodeIndex]))r(l.nodes[a.currentNodeIndex++]);else a.currentNodeIndex++;return a.currentNodeIndex<c}function d(){for(var c=l.nodes.length,f=0;f++<a.p.labelsSpeed&&a.currentLabelIndex<c;)if(a.isOnScreen(l.nodes[a.currentLabelIndex]))F(l.nodes[a.currentLabelIndex++]);else a.currentLabelIndex++;return a.currentLabelIndex<c}function r(c){var f=Math.round(c.displaySize*10)/10,k=b;k.fillStyle=c.color;k.beginPath();k.arc(c.displayX,
c.displayY,f,0,Math.PI*2,true);k.closePath();k.fill();c.hover&&G(c);return a}function A(c){var f=c.source.displayX,k=c.source.displayY,x=c.target.displayX,t=c.target.displayY,u=c.color;if(!u)switch(a.p.edgeColor){case "source":u=c.source.color||a.p.defaultNodeColor;break;case "target":u=c.target.color||a.p.defaultNodeColor;break;default:u=a.p.defaultEdgeColor;break}var y=n;switch(c.type||a.p.defaultEdgeType){case "curve":y.strokeStyle=u;y.lineWidth=c.displaySize/3;y.beginPath();y.moveTo(f,k);y.quadraticCurveTo((f+
x)/2+(t-k)/4,(k+t)/2+(f-x)/4,x,t);y.stroke();break;case "line":default:y.strokeStyle=u;y.lineWidth=c.displaySize/3;y.beginPath();y.moveTo(f,k);y.lineTo(x,t);y.stroke();break}return a}function F(c){var f=i;if(c.displaySize>=a.p.labelThreshold||c.forceLabel){var k=a.p.labelSize=="fixed"?a.p.defaultLabelSize:a.p.labelSizeRatio*c.displaySize;f.font=a.p.fontStyle+k+"px "+a.p.font;f.fillStyle=a.p.labelColor=="node"?c.color||a.p.defaultNodeColor:a.p.defaultLabelColor;f.fillText(c.label,Math.round(c.displayX+
c.displaySize*1.5),Math.round(c.displayY+k/2-3))}return a}function G(c){var f=p,k=a.p.labelSize=="fixed"?a.p.defaultLabelSize:a.p.labelSizeRatio*c.displaySize;f.font=(a.p.hoverFontStyle||a.p.fontStyle||"")+" "+k+"px "+(a.p.hoverFont||a.p.font||"");f.fillStyle=a.p.labelHoverBGColor=="node"?c.color||a.p.defaultNodeColor:a.p.defaultHoverLabelBGColor;f.beginPath();if(a.p.labelHoverShadow){f.shadowOffsetX=0;f.shadowOffsetY=0;f.shadowBlur=4;f.shadowColor=a.p.labelHoverShadowColor}sigma.tools.drawRoundRect(f,
Math.round(c.displayX-k/2-2),Math.round(c.displayY-k/2-2),Math.round(f.measureText(c.label).width+c.displaySize*1.5+k/2+4),Math.round(k+4),Math.round(k/2+2),"left");f.closePath();f.fill();f.shadowOffsetX=0;f.shadowOffsetY=0;f.shadowBlur=0;f.beginPath();f.fillStyle=a.p.nodeBorderColor=="node"?c.color||a.p.defaultNodeColor:a.p.defaultNodeBorderColor;f.arc(Math.round(c.displayX),Math.round(c.displayY),c.displaySize+a.p.borderSize,0,Math.PI*2,true);f.closePath();f.fill();f.beginPath();f.fillStyle=a.p.nodeHoverColor==
"node"?c.color||a.p.defaultNodeColor:a.p.defaultNodeHoverColor;f.arc(Math.round(c.displayX),Math.round(c.displayY),c.displaySize,0,Math.PI*2,true);f.closePath();f.fill();f.fillStyle=a.p.labelHoverColor=="node"?c.color||a.p.defaultNodeColor:a.p.defaultLabelHoverColor;f.fillText(c.label,Math.round(c.displayX+c.displaySize*1.5),Math.round(c.displayY+k/2-3));return a}function E(c){var f=p;if(!j(c))return a;var k=a.p.labelSize=="fixed"?a.p.defaultLabelSize:a.p.labelSizeRatio*c.displaySize;f.font=(a.p.activeFontStyle||
a.p.fontStyle||"")+" "+k+"px "+(a.p.activeFont||a.p.font||"");f.fillStyle=a.p.labelHoverBGColor=="node"?c.color||a.p.defaultNodeColor:a.p.defaultActiveLabelBGColor;f.beginPath();if(a.p.labelActiveShadow){f.shadowOffsetX=0;f.shadowOffsetY=0;f.shadowBlur=4;f.shadowColor=a.p.labelActiveShadowColor}sigma.tools.drawRoundRect(f,Math.round(c.displayX-k/2-2),Math.round(c.displayY-k/2-2),Math.round(f.measureText(c.label).width+c.displaySize*1.5+k/2+4),Math.round(k+4),Math.round(k/2+2),"left");f.closePath();
f.fill();f.shadowOffsetX=0;f.shadowOffsetY=0;f.shadowBlur=0;f.beginPath();f.fillStyle=a.p.nodeBorderColor=="node"?c.color||a.p.defaultNodeColor:a.p.defaultNodeBorderColor;f.arc(Math.round(c.displayX),Math.round(c.displayY),c.displaySize+a.p.borderSize,0,Math.PI*2,true);f.closePath();f.fill();f.beginPath();f.fillStyle=a.p.nodeActiveColor=="node"?c.color||a.p.defaultNodeColor:a.p.defaultNodeActiveColor;f.arc(Math.round(c.displayX),Math.round(c.displayY),c.displaySize,0,Math.PI*2,true);f.closePath();
f.fill();f.fillStyle=a.p.labelActiveColor=="node"?c.color||a.p.defaultNodeColor:a.p.defaultLabelActiveColor;f.fillText(c.label,Math.round(c.displayX+c.displaySize*1.5),Math.round(c.displayY+k/2-3));return a}function j(c){if(isNaN(c.x)||isNaN(c.y))throw new Error("A node's coordinate is not a number (id: "+c.id+")");return!c.hidden&&c.displayX+c.displaySize>-g/3&&c.displayX-c.displaySize<g*4/3&&c.displayY+c.displaySize>-h/3&&c.displayY-c.displaySize<h*4/3}function U(c,f){g=c;h=f;return a}sigma.classes.Cascade.call(this);
var a=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:true,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:true,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,font:"Arial",hoverFont:"",
activeFont:"",fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200};b=b;n=n;i=i;p=p;l=l;var g=q,h=I;this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=0;this.task_drawLabel=d;this.task_drawEdge=
v;this.task_drawNode=P;this.drawActiveNode=E;this.drawHoverNode=G;this.isOnScreen=j;this.resize=U}function s(b){function n(m){return m.offsetX!=undefined&&m.offsetX||m.layerX!=undefined&&m.layerX||m.clientX!=undefined&&m.clientX}function i(m){return m.offsetY!=undefined&&m.offsetY||m.layerY!=undefined&&m.layerY||m.clientY!=undefined&&m.clientY}function p(m){return m.wheelDelta!=undefined&&m.wheelDelta||m.detail!=undefined&&-m.detail}function l(m){U=j.mouseX;a=j.mouseY;j.mouseX=n(m);j.mouseY=i(m);
j.isMouseDown&&r(m);j.dispatch("move");if(m.preventDefault)m.preventDefault();else m.returnValue=false}function q(m){if(j.p.mouseEnabled&&j.isMouseDown){j.isMouseDown=false;j.dispatch("mouseup");d();if(m.preventDefault)m.preventDefault();else m.returnValue=false}}function I(m){if(j.p.mouseEnabled){j.isMouseDown=true;U=j.mouseX;a=j.mouseY;j.dispatch("mousedown");P();if(m.preventDefault)m.preventDefault();else m.returnValue=false}}function v(m){if(j.p.mouseEnabled){A(j.mouseX,j.mouseY,j.ratio*(p(m)>
0?j.p.zoomMultiply:1/j.p.zoomMultiply));if(j.p.blockScroll)if(m.preventDefault)m.preventDefault();else m.returnValue=false}}function P(){c=j.stageX;f=j.stageY;g=j.mouseX;h=j.mouseY;L=y=j.stageX;R=Q=j.stageY;j.dispatch("startdrag")}function d(){if(c!=j.stageX||f!=j.stageY)A(j.stageX+j.p.inertia*(j.stageX-L),j.stageY+j.p.inertia*(j.stageY-R))}function r(){var m=j.mouseX-g+c,J=j.mouseY-h+f;if(m!=j.stageX||J!=j.stageY){L=y;R=Q;y=m;Q=J;j.stageX=m;j.stageY=J;j.dispatch("drag")}}function A(m,J,o){if(!j.isMouseDown){window.clearInterval(j.interpolationID);
C=o!=undefined;c=j.stageX;t=m;f=j.stageY;u=J;k=j.ratio;x=o||j.ratio;x=Math.min(Math.max(x,j.p.minRatio),j.p.maxRatio);z=j.p.directZooming?1-(C?j.p.zoomDelta:j.p.dragDelta):0;if(j.ratio!=x||j.stageX!=t||j.stageY!=u){G();j.interpolationID=window.setInterval(G,50);j.dispatch("startinterpolate")}}}function F(){var m=j.ratio;if(C){j.ratio=x;j.stageX=t+(j.stageX-t)*j.ratio/m;j.stageY=u+(j.stageY-u)*j.ratio/m}else{j.stageX=t;j.stageY=u}j.dispatch("stopinterpolate")}function G(){z+=C?j.p.zoomDelta:j.p.dragDelta;
z=Math.min(z,1);var m=sigma.easing.quadratic.easeout(z),J=j.ratio;j.ratio=J*(1-m)+x*m;if(C){j.stageX=t+(j.stageX-t)*j.ratio/J;j.stageY=u+(j.stageY-u)*j.ratio/J}else{j.stageX=c*(1-m)+t*m;j.stageY=f*(1-m)+u*m}j.dispatch("interpolate");if(z>=1){window.clearInterval(j.interpolationID);F()}}function E(){return j}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var j=this;b=b;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,directZooming:false,
blockScroll:true,inertia:1.1,mouseEnabled:true};var U=0,a=0,g=0,h=0,c=0,f=0,k=1,x=1,t=0,u=0,y=0,L=0,Q=0,R=0,z=0,C=false;this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isMouseDown=false;b.addEventListener("DOMMouseScroll",v,true);b.addEventListener("mousewheel",v,true);b.addEventListener("mousemove",l,true);b.addEventListener("mousedown",I,true);document.addEventListener("mouseup",q,true);this.checkBorders=E;this.interpolate=A}function M(b){var n=this;sigma.classes.EventDispatcher.call(this);
this._core=b;this.kill=function(){};this.getID=function(){return b.id};this.configProperties=function(i,p){i=b.config(i,p);return i==b?n:i};this.drawingProperties=function(i,p){i=b.plotter.config(i,p);return i==b.plotter?n:i};this.mouseProperties=function(i,p){i=b.mousecaptor.config(i,p);return i==b.mousecaptor?n:i};this.graphProperties=function(i,p){i=b.graph.config(i,p);return i==b.graph?n:i};this.getMouse=function(){return{mouseX:b.mousecaptor.mouseX,mouseY:b.mousecaptor.mouseY,down:b.mousecaptor.isMouseDown}};
this.position=function(i,p,l){if(arguments.length==0)return{stageX:b.mousecaptor.stageX,stageY:b.mousecaptor.stageY,ratio:b.mousecaptor.ratio};else{b.mousecaptor.stageX=i!=undefined?i:b.mousecaptor.stageX;b.mousecaptor.stageY=p!=undefined?p:b.mousecaptor.stageY;b.mousecaptor.ratio=l!=undefined?l:b.mousecaptor.ratio;return n}};this.goTo=function(i,p,l){b.mousecaptor.interpolate(i,p,l);return n};this.zoomTo=function(i,p,l){l=Math.min(Math.max(b.mousecaptor.config("minRatio"),l),b.mousecaptor.config("maxRatio"));
l==b.mousecaptor.ratio?b.mousecaptor.interpolate(i-b.width/2+b.mousecaptor.stageX,p-b.height/2+b.mousecaptor.stageY):b.mousecaptor.interpolate((l*i-b.mousecaptor.ratio*b.width/2)/(l-b.mousecaptor.ratio),(l*p-b.mousecaptor.ratio*b.height/2)/(l-b.mousecaptor.ratio),l);return n};this.resize=function(i,p){b.resize(i,p);return n};this.draw=function(i,p,l,q){b.draw(i,p,l,q);return n};this.refresh=function(){b.refresh();return n};this.addGenerator=function(i,p,l){sigma.chronos.addGenerator(i+"_ext_"+b.id,
p,l);return n};this.removeGenerator=function(i){sigma.chronos.removeGenerator(i+"_ext_"+b.id);return n};this.addNode=function(i,p){b.graph.addNode(i,p);return n};this.addEdge=function(i,p,l,q){b.graph.addEdge(i,p,l,q);return n};this.dropNode=function(i){b.graph.dropNode(i);return n};this.dropEdge=function(i){b.graph.dropEdge(i);return n};this.pushGraph=function(i,p){i.nodes&&i.nodes.forEach(function(l){l.id&&(!p||!b.graph.nodesIndex[l.id])&&n.addNode(l.id,l)});i.edges&&i.edges.forEach(function(l){(validID=
l.source&&l.target&&l.id)&&(!p||!b.graph.edgesIndex[l.id])&&n.addNode(l.id,l.source,l.target,l)});return n};this.emptyGraph=function(){b.graph.empty();return n};this.getNodesCount=function(){return b.graph.nodes.length};this.getEdgesCount=function(){return b.graph.edges.length};this.iterNodes=function(i,p){b.graph.iterNodes(i,p);return n};this.iterEdges=function(i,p){b.graph.iterEdges(i,p);return n};this.getNodes=function(i){return b.graph.getNodes(i)};this.getEdges=function(i){return b.graph.getEdges(i)};
this.activateMonitoring=function(){return b.monitor.activate()};this.desactivateMonitoring=function(){return b.monitor.desactivate()};b.bind("downnodes upnodes downgraph upgraph",function(i){n.dispatch(i.type,i.content)});b.graph.bind("overnodes outnodes",function(i){n.dispatch(i.type,i.content)})}var w=0,O={};O.plugins=[];sigma.init=function(b){b=new H(b,(++w).toString());sigma.instances[w]=new M(b);return sigma.instances[w]};sigma.tools.drawRoundRect=function(b,n,i,p,l,q,I){q=q?q:0;var v=I?I:[];
v=typeof v=="string"?v.split(" "):v;I=q&&(v.indexOf("topleft")>=0||v.indexOf("top")>=0||v.indexOf("left")>=0);var P=q&&(v.indexOf("topright")>=0||v.indexOf("top")>=0||v.indexOf("right")>=0),d=q&&(v.indexOf("bottomleft")>=0||v.indexOf("bottom")>=0||v.indexOf("left")>=0);v=q&&(v.indexOf("bottomright")>=0||v.indexOf("bottom")>=0||v.indexOf("right")>=0);b.moveTo(n,i+q);I?b.arcTo(n,i,n+q,i,q):b.lineTo(n,i);if(P){b.lineTo(n+p-q,i);b.arcTo(n+p,i,n+p,i+q,q)}else b.lineTo(n+p,i);if(v){b.lineTo(n+p,i+l-q);
b.arcTo(n+p,i+l,n+p-q,i+l,q)}else b.lineTo(n+p,i+l);if(d){b.lineTo(n+q,i+l);b.arcTo(n,i+l,n,i+l-q,q)}else b.lineTo(n,i+l);b.lineTo(n,i+q)};sigma.tools.getRGB=function(b,n){b=b.toString();var i={r:0,g:0,b:0};if(b.length>=3)if(b.charAt(0)=="#"){var p=b.length-1;if(p==6)i={r:parseInt(b.charAt(1)+b.charAt(2),16),g:parseInt(b.charAt(3)+b.charAt(4),16),b:parseInt(b.charAt(5)+b.charAt(5),16)};else if(p==3)i={r:parseInt(b.charAt(1)+b.charAt(1),16),g:parseInt(b.charAt(2)+b.charAt(2),16),b:parseInt(b.charAt(3)+
b.charAt(3),16)}}if(n)i=[i.r,i.g,i.b];return i};sigma.tools.rgbToHex=function(b,n,i){return sigma.tools.toHex(b)+sigma.tools.toHex(n)+sigma.tools.toHex(i)};sigma.tools.toHex=function(b){b=parseInt(b,10);if(isNaN(b))return"00";b=Math.max(0,Math.min(b,255));return"0123456789ABCDEF".charAt((b-b%16)/16)+"0123456789ABCDEF".charAt(b%16)};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(b){return b};sigma.easing.quadratic.easein=function(b){return b*b};sigma.easing.quadratic.easeout=
function(b){return-b*(b-2)};sigma.easing.quadratic.easeinout=function(b){if((b*=2)<1)return 0.5*b*b;return-0.5*(--b*(b-2)-1)};sigma.debugMode=0;sigma.log=function(){if(sigma.debugMode==1)for(var b in arguments)console.log(arguments[b]);else if(sigma.debugMode>1)for(b in arguments)throw new Error(arguments[b]);return sigma};sigma.addPlugin=function(b,n,i){M.prototype[b]=n;O.plugins.push(i)};sigma.chronos=new (function(){function b(o){window.setTimeout(o,0);return h}function n(){for(h.dispatch("frameinserted");c&&
C.length&&i(););if(!c||!C.length)l();else{Q=(new Date).getTime();x++;R=y-t;u=t-R;h.dispatch("insertframe");b(n)}}function i(){J%=C.length;if(!C[J].task()){var o=C[J].taskName;m=m.filter(function(K){K.taskParent==o&&C.push({taskName:K.taskName,task:K.task});return K.taskParent!=o});h.dispatch("killed",C.splice(J--,1)[0])}J++;y=(new Date).getTime()-Q;return y<=u}function p(){c=true;x=J=0;L=Q=(new Date).getTime();h.dispatch("start");h.dispatch("insertframe");b(n);return h}function l(){h.dispatch("stop");
c=false;return h}function q(o,K,S){if(typeof o!="function")throw new Error('Task "'+K+'" is not a function');C.push({taskName:K,task:o});c=!!(c||S&&p()||true);return h}function I(o,K,S){if(typeof o!="function")throw new Error('Task "'+K+'" is not a function');if(!C.concat(m).some(function(T){return T.taskName==S}))throw new Error('Parent task "'+S+'" of "'+K+'" is not attached.');m.push({taskParent:S,taskName:K,task:o});return h}function v(o,K){if(o==undefined){C=[];if(K==1)m=[];else if(K==2){C=m;
m=[]}l()}else{var S=typeof o=="string"?o:"";C=C.filter(function(T){if(typeof o=="string"?T.taskName==o:T.task==o){S=T.taskName;return false}return true});if(K>0)m=m.filter(function(T){K==1&&T.taskParent==S&&C.push(T);return T.taskParent!=S})}c=!!(!C.length||l()&&false);return h}function P(o,K,S){if(z[o]!=undefined)return h;z[o]={task:K,condition:S};r(true)==0&&F();return h}function d(o){if(z[o]){z[o].on=false;z[o].del=true}return h}function r(o){return o?Object.keys(z).filter(function(K){return!!z[K].on}).length:
Object.keys(z).length}function A(){return Object.keys(z)}function F(){if(Object.keys(z).length){h.dispatch("startgenerators");h.unbind("killed",G);b(function(){for(var o in z){z[o].on=true;q(z[o].task,o,false)}});h.bind("killed",G).runTasks()}else h.dispatch("stopgenerators");return h}function G(o){if(z[o.content.taskName]!=undefined){if(z[o.content.taskName].del||!z[o.content.taskName].condition())delete z[o.content.taskName];else z[o.content.taskName].on=false;r(true)==0&&F()}}function E(o){if(o!=
undefined){f=Math.abs(1*o);t=1E3/f;x=0;return h}else return f}function j(){if(c)k=Math.round(x/((new Date).getTime()-L)*1E4)/10;return k}function U(){return C.length}function a(){return m.length}function g(){return Q-L}sigma.classes.EventDispatcher.call(this);var h=this,c=false,f=80,k=0,x=0,t=1E3/f,u=t,y=0,L=0,Q=0,R=0,z={},C=[],m=[],J=0;this.frequency=E;this.runTasks=p;this.stopTasks=l;this.insertFrame=b;this.addTask=q;this.queueTask=I;this.removeTask=v;this.addGenerator=P;this.removeGenerator=d;
this.startGenerators=F;this.getGeneratorsIDs=A;this.getFPS=j;this.getTasksCount=U;this.getQueuedTasksCount=a;this.getExecutionTime=g;return this});sigma.publicPrototype=M.prototype})();
